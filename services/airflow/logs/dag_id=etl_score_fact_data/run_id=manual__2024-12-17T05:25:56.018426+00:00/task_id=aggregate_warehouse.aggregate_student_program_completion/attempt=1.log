[2024-12-17T05:26:30.346+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-12-17T05:26:30.445+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: etl_score_fact_data.aggregate_warehouse.aggregate_student_program_completion manual__2024-12-17T05:25:56.018426+00:00 [queued]>
[2024-12-17T05:26:30.489+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: etl_score_fact_data.aggregate_warehouse.aggregate_student_program_completion manual__2024-12-17T05:25:56.018426+00:00 [queued]>
[2024-12-17T05:26:30.489+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-12-17T05:26:30.528+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): aggregate_warehouse.aggregate_student_program_completion> on 2024-12-17 05:25:56.018426+00:00
[2024-12-17T05:26:30.579+0000] {warnings.py:110} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:61: DeprecationWarning: This process (pid=38121) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-12-17T05:26:30.585+0000] {standard_task_runner.py:63} INFO - Started process 38140 to run task
[2024-12-17T05:26:30.598+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'etl_score_fact_data', 'aggregate_warehouse.aggregate_student_program_completion', 'manual__2024-12-17T05:25:56.018426+00:00', '--job-id', '893', '--raw', '--subdir', 'DAGS_FOLDER/elt_score_fact.py', '--cfg-path', '/tmp/tmpt7afb907']
[2024-12-17T05:26:30.616+0000] {standard_task_runner.py:91} INFO - Job 893: Subtask aggregate_warehouse.aggregate_student_program_completion
[2024-12-17T05:26:30.901+0000] {task_command.py:426} INFO - Running <TaskInstance: etl_score_fact_data.aggregate_warehouse.aggregate_student_program_completion manual__2024-12-17T05:25:56.018426+00:00 [running]> on host 2f4e9c743994
[2024-12-17T05:26:31.652+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='etl_score_fact_data' AIRFLOW_CTX_TASK_ID='aggregate_warehouse.aggregate_student_program_completion' AIRFLOW_CTX_EXECUTION_DATE='2024-12-17T05:25:56.018426+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-12-17T05:25:56.018426+00:00'
[2024-12-17T05:26:31.653+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-12-17T05:26:31.719+0000] {hive.py:475} INFO - USE `default`
[2024-12-17T05:26:31.889+0000] {hive.py:475} INFO - CREATE NAMESPACE IF NOT EXISTS iceberg.aggr_warehouse
[2024-12-17T05:26:32.159+0000] {hive.py:475} INFO - DROP TABLE IF EXISTS iceberg.aggr_warehouse.student_program_completion
[2024-12-17T05:26:32.791+0000] {hive.py:475} INFO - 
        CREATE OR REPLACE TABLE iceberg.aggr_warehouse.student_program_completion
        USING parquet
        AS
        WITH program_requirements AS (
            SELECT
                ps.program_id,
                SUM(ps.required_credit) AS total_required_credit,
                SUM(ps.elective_credit) AS total_elective_credit
            FROM
                iceberg.warehouse.program_semester ps
            GROUP BY
                ps.program_id
        ),
        latest_student_scores AS (
            SELECT
                s.student_id,
                s.student_name,
                ps.program_id,
                ps.program_semester_id,
                c.course_code,
                c.category,
                c.total_credit,
                sf.final_score,
                ROW_NUMBER() OVER (
                    PARTITION BY s.student_id, c.course_code
                    ORDER BY inf.instruction_time_end DESC
                ) AS attempt_rank
            FROM
                iceberg.warehouse.student s
            JOIN iceberg.warehouse.enroll_student es ON s.student_id = es.student_id
            JOIN iceberg.warehouse.enrollment_fact ef ON es.enrollment_id = ef.enrollment_id
            JOIN iceberg.warehouse.instruction_fact inf ON ef.instruction_id = inf.instruction_id
            JOIN iceberg.warehouse.program_semester ps ON inf.program_semester_id = ps.program_semester_id
            JOIN iceberg.warehouse.course c ON inf.course_id = c.course_id
            LEFT JOIN iceberg.warehouse.score_fact sf ON sf.instruction_id = inf.instruction_id AND sf.student_id = s.student_id
        ),
        student_courses_passed AS (
            SELECT
                lss.student_id,
                lss.student_name,
                lss.program_id,
                lss.course_code,
                lss.category,
                lss.total_credit
            FROM
                latest_student_scores lss
            WHERE
                lss.attempt_rank = 1
                AND lss.final_score >= 4
        ),
        student_courses_registered AS (
            SELECT DISTINCT
                lss.student_id,
                lss.student_name,
                lss.program_id,
                lss.course_code,
                lss.category,
                lss.total_credit
            FROM
                latest_student_scores lss
        ),
        aggregated_student_courses AS (
            SELECT
                scp.student_id,
                scp.student_name,
                scp.program_id,
                pr.total_required_credit,
                pr.total_elective_credit,
                COALESCE(SUM(CASE WHEN scp.category = 'required' THEN scp.total_credit ELSE 0 END), 0) AS total_required_credit_registered,
                COALESCE(SUM(CASE WHEN scp.category = 'elective' THEN scp.total_credit ELSE 0 END), 0) AS total_elective_credit_registered,
                COALESCE(SUM(CASE WHEN scp.category = 'required' THEN scp.total_credit ELSE 0 END * 
                    (CASE WHEN scp.final_score >= 4 THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed,
                COALESCE(SUM(CASE WHEN scp.category = 'elective' THEN scp.total_credit ELSE 0 END * 
                    (CASE WHEN scp.final_score >= 4 THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed
            FROM
                student_courses_registered scp
            JOIN program_requirements pr ON scp.program_id = pr.program_id
            LEFT JOIN student_courses_passed scp_passed ON scp.student_id = scp_passed.student_id 
                AND scp.course_code = scp_passed.course_code 
                AND scp.program_id = scp_passed.program_id
            GROUP BY
                scp.student_id,
                scp.student_name,
                scp.program_id,
                pr.total_required_credit,
                pr.total_elective_credit
        )
        SELECT
            sc.student_id,
            sc.student_name,
            sc.program_id,
            sc.total_required_credit,
            sc.total_elective_credit,
            sc.total_required_credit_registered,
            sc.total_elective_credit_registered,
            sc.total_required_credit_passed,
            sc.total_elective_credit_passed,
            CASE 
                WHEN sc.total_required_credit_passed >= sc.total_required_credit
                    AND sc.total_elective_credit_passed >= sc.total_elective_credit
                THEN 'Completed'
                ELSE 'Not Completed'
            END AS completion_status
        FROM
            aggregated_student_courses sc
        ;
    
[2024-12-17T05:26:36.508+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-12-17T05:26:36.511+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 400, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/tasks/fit_task.py", line 138, in aggregate_into_warehouse
    cursor.execute(FIT_AGGREGATE_TABLES[table]["create_table_command"])
  File "/home/airflow/.local/lib/python3.12/site-packages/pyhive/hive.py", line 481, in execute
    _check_status(response)
  File "/home/airflow/.local/lib/python3.12/site-packages/pyhive/hive.py", line 611, in _check_status
    raise OperationalError(response)
pyhive.exc.OperationalError: TExecuteStatementResp(status=TStatus(statusCode=3, infoMessages=["*org.apache.hive.service.cli.HiveSQLException:Error running query: [UNRESOLVED_COLUMN.WITH_SUGGESTION] org.apache.spark.sql.AnalysisException: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `scp`.`final_score` cannot be resolved. Did you mean one of the following? [`scp`.`category`, `scp`.`course_code`, `scp`.`total_credit`, `scp`.`program_id`, `scp`.`student_id`].; line 73 pos 31;\n'ReplaceTableAsSelect TableSpec(Map(),Some(parquet),Map(),None,None,None,false), true, false\n:- ResolvedIdentifier org.apache.iceberg.spark.SparkCatalog@2c3ff8ee, aggr_warehouse.student_program_completion\n+- 'Project ['sc.student_id, 'sc.student_name, 'sc.program_id, 'sc.total_required_credit, 'sc.total_elective_credit, 'sc.total_required_credit_registered, 'sc.total_elective_credit_registered, 'sc.total_required_credit_passed, 'sc.total_elective_credit_passed, CASE WHEN (('sc.total_required_credit_passed >= 'sc.total_required_credit) AND ('sc.total_elective_credit_passed >= 'sc.total_elective_credit)) THEN Completed ELSE Not Completed END AS completion_status#10593]\n   +- 'SubqueryAlias sc\n      +- 'SubqueryAlias aggregated_student_courses\n         +- 'Aggregate [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L], [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L, coalesce(sum(CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_required_credit_registered#10629L, coalesce(sum(CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_elective_credit_registered#10630L, 'COALESCE('SUM((CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed#10631, 'COALESCE('SUM((CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed#10638]\n            +- Join LeftOuter, (((student_id#10647 = student_id#10786) AND (course_code#10762L = course_code#10829L)) AND (program_id#10744 = program_id#10822))\n               :- Join Inner, (program_id#10744 = program_id#10781)\n               :  :- SubqueryAlias scp\n               :  :  +- SubqueryAlias student_courses_registered\n               :  :     +- Distinct\n               :  :        +- Project [student_id#10647, student_name#10648, program_id#10744, course_code#10762L, category#10763, total_credit#10764L]\n               :  :           +- SubqueryAlias lss\n               :  :              +- SubqueryAlias latest_student_scores\n               :  :                 +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, attempt_rank#10628]\n               :  :                    +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697, attempt_rank#10628, attempt_rank#10628]\n               :  :                       +- Window [row_number() windowspecdefinition(student_id#10647, course_code#10762L, instruction_time_end#10697 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10647, course_code#10762L], [instruction_time_end#10697 DESC NULLS LAST]\n               :  :                          +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697]\n               :  :                             +- Join LeftOuter, ((instruction_id#10772L = instruction_id#10685L) AND (student_id#10773 = student_id#10647))\n               :  :                                :- Join Inner, (course_id#10687L = course_id#10760L)\n               :  :                                :  :- Join Inner, (program_semester_id#10686 = program_semester_id#10743)\n               :  :                                :  :  :- Join Inner, (instruction_id#10678L = instruction_id#10685L)\n               :  :                                :  :  :  :- Join Inner, (enrollment_id#10673L = enrollment_id#10677L)\n               :  :                                :  :  :  :  :- Join Inner, (student_id#10647 = student_id#10672)\n               :  :                                :  :  :  :  :  :- SubqueryAlias s\n               :  :                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n               :  :                                :  :  :  :  :  :     +- RelationV2[student_id#10647, student_name#10648, class_name#10649, edu_mail#10650, address_id#10651L, national_id#10652L, key_year#10653, gender#10654, student_dob#10655] iceberg.warehouse.student iceberg.warehouse.student\n               :  :                                :  :  :  :  :  +- SubqueryAlias es\n               :  :                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  :        +- RelationV2[student_id#10672, enrollment_id#10673L, enrollment_time#10674] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  +- SubqueryAlias ef\n               :  :                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  :        +- RelationV2[enrollment_id#10677L, instruction_id#10678L, enrollment_start_time#10679, enrollment_end_time#10680, enrollment_class#10681, enrollment_status#10682, last_modified_date#10683, etl_date#10684] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  +- SubqueryAlias inf\n               :  :                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n               :  :                                :  :  :        +- RelationV2[instruction_id#10685L, program_semester_id#10686, course_id#10687L, class_id#10688L, is_required#10689, num_student#10690L, num_pass_student#10691L, num_fail_student#10692L, avg_final_score#10693, instruction_status#10694, instruction_allocate#10695, instruction_time_start#10696, instruction_time_end#10697, last_modified_date#10698, etl_date#10699] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n               :  :                                :  :  +- SubqueryAlias ps\n               :  :                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n               :  :                                :  :        +- RelationV2[program_semester_id#10743, program_id#10744, semester_name#10745, total_credit#10746L, required_credit#10747L, elective_credit#10748L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               :  :                                :  +- SubqueryAlias c\n               :  :                                :     +- SubqueryAlias iceberg.warehouse.course\n               :  :                                :        +- RelationV2[course_id#10760L, course_name#10761, course_code#10762L, category#10763, total_credit#10764L, theory_credit#10765L, practice_credit#10766L, self_learning_credit#10767L] iceberg.warehouse.course iceberg.warehouse.course\n               :  :                                +- SubqueryAlias sf\n               :  :                                   +- SubqueryAlias iceberg.warehouse.score_fact\n               :  :                                      +- RelationV2[score_id#10771L, instruction_id#10772L, student_id#10773, final_score#10774, final_score_4#10775, academic_rank#10776, is_practice#10777, last_modified_date#10778, etl_date#10779] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n               :  +- SubqueryAlias pr\n               :     +- SubqueryAlias program_requirements\n               :        +- Aggregate [program_id#10781], [program_id#10781, sum(required_credit#10784L) AS total_required_credit#10594L, sum(elective_credit#10785L) AS total_elective_credit#10595L]\n               :           +- SubqueryAlias ps\n               :              +- SubqueryAlias iceberg.warehouse.program_semester\n               :                 +- RelationV2[program_semester_id#10780, program_id#10781, semester_name#10782, total_credit#10783L, required_credit#10784L, elective_credit#10785L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               +- SubqueryAlias scp_passed\n                  +- SubqueryAlias student_courses_passed\n                     +- Project [student_id#10786, student_name#10787, program_id#10822, course_code#10829L, category#10830, total_credit#10831L]\n                        +- Filter ((attempt_rank#10628 = 1) AND (final_score#10838 >= cast(4 as double)))\n                           +- SubqueryAlias lss\n                              +- SubqueryAlias latest_student_scores\n                                 +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, attempt_rank#10628]\n                                    +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818, attempt_rank#10628, attempt_rank#10628]\n                                       +- Window [row_number() windowspecdefinition(student_id#10786, course_code#10829L, instruction_time_end#10818 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10786, course_code#10829L], [instruction_time_end#10818 DESC NULLS LAST]\n                                          +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818]\n                                             +- Join LeftOuter, ((instruction_id#10836L = instruction_id#10806L) AND (student_id#10837 = student_id#10786))\n                                                :- Join Inner, (course_id#10808L = course_id#10827L)\n                                                :  :- Join Inner, (program_semester_id#10807 = program_semester_id#10821)\n                                                :  :  :- Join Inner, (instruction_id#10799L = instruction_id#10806L)\n                                                :  :  :  :- Join Inner, (enrollment_id#10796L = enrollment_id#10798L)\n                                                :  :  :  :  :- Join Inner, (student_id#10786 = student_id#10795)\n                                                :  :  :  :  :  :- SubqueryAlias s\n                                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n                                                :  :  :  :  :  :     +- RelationV2[student_id#10786, student_name#10787, class_name#10788, edu_mail#10789, address_id#10790L, national_id#10791L, key_year#10792, gender#10793, student_dob#10794] iceberg.warehouse.student iceberg.warehouse.student\n                                                :  :  :  :  :  +- SubqueryAlias es\n                                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n                                                :  :  :  :  :        +- RelationV2[student_id#10795, enrollment_id#10796L, enrollment_time#10797] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n                                                :  :  :  :  +- SubqueryAlias ef\n                                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n                                                :  :  :  :        +- RelationV2[enrollment_id#10798L, instruction_id#10799L, enrollment_start_time#10800, enrollment_end_time#10801, enrollment_class#10802, enrollment_status#10803, last_modified_date#10804, etl_date#10805] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n                                                :  :  :  +- SubqueryAlias inf\n                                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n                                                :  :  :        +- RelationV2[instruction_id#10806L, program_semester_id#10807, course_id#10808L, class_id#10809L, is_required#10810, num_student#10811L, num_pass_student#10812L, num_fail_student#10813L, avg_final_score#10814, instruction_status#10815, instruction_allocate#10816, instruction_time_start#10817, instruction_time_end#10818, last_modified_date#10819, etl_date#10820] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n                                                :  :  +- SubqueryAlias ps\n                                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n                                                :  :        +- RelationV2[program_semester_id#10821, program_id#10822, semester_name#10823, total_credit#10824L, required_credit#10825L, elective_credit#10826L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n                                                :  +- SubqueryAlias c\n                                                :     +- SubqueryAlias iceberg.warehouse.course\n                                                :        +- RelationV2[course_id#10827L, course_name#10828, course_code#10829L, category#10830, total_credit#10831L, theory_credit#10832L, practice_credit#10833L, self_learning_credit#10834L] iceberg.warehouse.course iceberg.warehouse.course\n                                                +- SubqueryAlias sf\n                                                   +- SubqueryAlias iceberg.warehouse.score_fact\n                                                      +- RelationV2[score_id#10835L, instruction_id#10836L, student_id#10837, final_score#10838, final_score_4#10839, academic_rank#10840, is_practice#10841, last_modified_date#10842, etl_date#10843] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n:36:35", 'org.apache.spark.sql.hive.thriftserver.HiveThriftServerErrors$:runningQueryError:HiveThriftServerErrors.scala:43', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:org$apache$spark$sql$hive$thriftserver$SparkExecuteStatementOperation$$execute:SparkExecuteStatementOperation.scala:262', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:runInternal:SparkExecuteStatementOperation.scala:152', 'org.apache.hive.service.cli.operation.Operation:run:Operation.java:277', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:org$apache$spark$sql$hive$thriftserver$SparkOperation$$super$run:SparkExecuteStatementOperation.scala:41', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:$anonfun$run$1:SparkOperation.scala:45', 'scala.runtime.java8.JFunction0$mcV$sp:apply:JFunction0$mcV$sp.java:23', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:withLocalProperties:SparkOperation.scala:79', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:withLocalProperties$:SparkOperation.scala:63', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:withLocalProperties:SparkExecuteStatementOperation.scala:41', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:run:SparkOperation.scala:45', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:run$:SparkOperation.scala:43', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:run:SparkExecuteStatementOperation.scala:41', 'org.apache.hive.service.cli.session.HiveSessionImpl:executeStatementInternal:HiveSessionImpl.java:484', 'org.apache.hive.service.cli.session.HiveSessionImpl:executeStatement:HiveSessionImpl.java:460', 'jdk.internal.reflect.GeneratedMethodAccessor17:invoke::-1', 'jdk.internal.reflect.DelegatingMethodAccessorImpl:invoke::-1', 'java.lang.reflect.Method:invoke::-1', 'org.apache.hive.service.cli.session.HiveSessionProxy:invoke:HiveSessionProxy.java:71', 'org.apache.hive.service.cli.session.HiveSessionProxy:lambda$invoke$0:HiveSessionProxy.java:58', 'java.security.AccessController:doPrivileged::-2', 'javax.security.auth.Subject:doAs::-1', 'org.apache.hadoop.security.UserGroupInformation:doAs:UserGroupInformation.java:1878', 'org.apache.hive.service.cli.session.HiveSessionProxy:invoke:HiveSessionProxy.java:58', 'com.sun.proxy.$Proxy39:executeStatement::-1', 'org.apache.hive.service.cli.CLIService:executeStatement:CLIService.java:282', 'org.apache.hive.service.cli.thrift.ThriftCLIService:ExecuteStatement:ThriftCLIService.java:453', 'org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement:getResult:TCLIService.java:1557', 'org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement:getResult:TCLIService.java:1542', 'org.apache.thrift.ProcessFunction:process:ProcessFunction.java:38', 'org.apache.thrift.TBaseProcessor:process:TBaseProcessor.java:39', 'org.apache.hive.service.auth.TSetIpAddressProcessor:process:TSetIpAddressProcessor.java:52', 'org.apache.thrift.server.TThreadPoolServer$WorkerProcess:run:TThreadPoolServer.java:310', 'java.util.concurrent.ThreadPoolExecutor:runWorker::-1', 'java.util.concurrent.ThreadPoolExecutor$Worker:run::-1', 'java.lang.Thread:run::-1', "*org.apache.spark.sql.catalyst.ExtendedAnalysisException:[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `scp`.`final_score` cannot be resolved. Did you mean one of the following? [`scp`.`category`, `scp`.`course_code`, `scp`.`total_credit`, `scp`.`program_id`, `scp`.`student_id`].; line 73 pos 31;\n'ReplaceTableAsSelect TableSpec(Map(),Some(parquet),Map(),None,None,None,false), true, false\n:- ResolvedIdentifier org.apache.iceberg.spark.SparkCatalog@2c3ff8ee, aggr_warehouse.student_program_completion\n+- 'Project ['sc.student_id, 'sc.student_name, 'sc.program_id, 'sc.total_required_credit, 'sc.total_elective_credit, 'sc.total_required_credit_registered, 'sc.total_elective_credit_registered, 'sc.total_required_credit_passed, 'sc.total_elective_credit_passed, CASE WHEN (('sc.total_required_credit_passed >= 'sc.total_required_credit) AND ('sc.total_elective_credit_passed >= 'sc.total_elective_credit)) THEN Completed ELSE Not Completed END AS completion_status#10593]\n   +- 'SubqueryAlias sc\n      +- 'SubqueryAlias aggregated_student_courses\n         +- 'Aggregate [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L], [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L, coalesce(sum(CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_required_credit_registered#10629L, coalesce(sum(CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_elective_credit_registered#10630L, 'COALESCE('SUM((CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed#10631, 'COALESCE('SUM((CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed#10638]\n            +- Join LeftOuter, (((student_id#10647 = student_id#10786) AND (course_code#10762L = course_code#10829L)) AND (program_id#10744 = program_id#10822))\n               :- Join Inner, (program_id#10744 = program_id#10781)\n               :  :- SubqueryAlias scp\n               :  :  +- SubqueryAlias student_courses_registered\n               :  :     +- Distinct\n               :  :        +- Project [student_id#10647, student_name#10648, program_id#10744, course_code#10762L, category#10763, total_credit#10764L]\n               :  :           +- SubqueryAlias lss\n               :  :              +- SubqueryAlias latest_student_scores\n               :  :                 +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, attempt_rank#10628]\n               :  :                    +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697, attempt_rank#10628, attempt_rank#10628]\n               :  :                       +- Window [row_number() windowspecdefinition(student_id#10647, course_code#10762L, instruction_time_end#10697 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10647, course_code#10762L], [instruction_time_end#10697 DESC NULLS LAST]\n               :  :                          +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697]\n               :  :                             +- Join LeftOuter, ((instruction_id#10772L = instruction_id#10685L) AND (student_id#10773 = student_id#10647))\n               :  :                                :- Join Inner, (course_id#10687L = course_id#10760L)\n               :  :                                :  :- Join Inner, (program_semester_id#10686 = program_semester_id#10743)\n               :  :                                :  :  :- Join Inner, (instruction_id#10678L = instruction_id#10685L)\n               :  :                                :  :  :  :- Join Inner, (enrollment_id#10673L = enrollment_id#10677L)\n               :  :                                :  :  :  :  :- Join Inner, (student_id#10647 = student_id#10672)\n               :  :                                :  :  :  :  :  :- SubqueryAlias s\n               :  :                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n               :  :                                :  :  :  :  :  :     +- RelationV2[student_id#10647, student_name#10648, class_name#10649, edu_mail#10650, address_id#10651L, national_id#10652L, key_year#10653, gender#10654, student_dob#10655] iceberg.warehouse.student iceberg.warehouse.student\n               :  :                                :  :  :  :  :  +- SubqueryAlias es\n               :  :                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  :        +- RelationV2[student_id#10672, enrollment_id#10673L, enrollment_time#10674] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  +- SubqueryAlias ef\n               :  :                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  :        +- RelationV2[enrollment_id#10677L, instruction_id#10678L, enrollment_start_time#10679, enrollment_end_time#10680, enrollment_class#10681, enrollment_status#10682, last_modified_date#10683, etl_date#10684] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  +- SubqueryAlias inf\n               :  :                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n               :  :                                :  :  :        +- RelationV2[instruction_id#10685L, program_semester_id#10686, course_id#10687L, class_id#10688L, is_required#10689, num_student#10690L, num_pass_student#10691L, num_fail_student#10692L, avg_final_score#10693, instruction_status#10694, instruction_allocate#10695, instruction_time_start#10696, instruction_time_end#10697, last_modified_date#10698, etl_date#10699] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n               :  :                                :  :  +- SubqueryAlias ps\n               :  :                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n               :  :                                :  :        +- RelationV2[program_semester_id#10743, program_id#10744, semester_name#10745, total_credit#10746L, required_credit#10747L, elective_credit#10748L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               :  :                                :  +- SubqueryAlias c\n               :  :                                :     +- SubqueryAlias iceberg.warehouse.course\n               :  :                                :        +- RelationV2[course_id#10760L, course_name#10761, course_code#10762L, category#10763, total_credit#10764L, theory_credit#10765L, practice_credit#10766L, self_learning_credit#10767L] iceberg.warehouse.course iceberg.warehouse.course\n               :  :                                +- SubqueryAlias sf\n               :  :                                   +- SubqueryAlias iceberg.warehouse.score_fact\n               :  :                                      +- RelationV2[score_id#10771L, instruction_id#10772L, student_id#10773, final_score#10774, final_score_4#10775, academic_rank#10776, is_practice#10777, last_modified_date#10778, etl_date#10779] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n               :  +- SubqueryAlias pr\n               :     +- SubqueryAlias program_requirements\n               :        +- Aggregate [program_id#10781], [program_id#10781, sum(required_credit#10784L) AS total_required_credit#10594L, sum(elective_credit#10785L) AS total_elective_credit#10595L]\n               :           +- SubqueryAlias ps\n               :              +- SubqueryAlias iceberg.warehouse.program_semester\n               :                 +- RelationV2[program_semester_id#10780, program_id#10781, semester_name#10782, total_credit#10783L, required_credit#10784L, elective_credit#10785L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               +- SubqueryAlias scp_passed\n                  +- SubqueryAlias student_courses_passed\n                     +- Project [student_id#10786, student_name#10787, program_id#10822, course_code#10829L, category#10830, total_credit#10831L]\n                        +- Filter ((attempt_rank#10628 = 1) AND (final_score#10838 >= cast(4 as double)))\n                           +- SubqueryAlias lss\n                              +- SubqueryAlias latest_student_scores\n                                 +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, attempt_rank#10628]\n                                    +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818, attempt_rank#10628, attempt_rank#10628]\n                                       +- Window [row_number() windowspecdefinition(student_id#10786, course_code#10829L, instruction_time_end#10818 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10786, course_code#10829L], [instruction_time_end#10818 DESC NULLS LAST]\n                                          +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818]\n                                             +- Join LeftOuter, ((instruction_id#10836L = instruction_id#10806L) AND (student_id#10837 = student_id#10786))\n                                                :- Join Inner, (course_id#10808L = course_id#10827L)\n                                                :  :- Join Inner, (program_semester_id#10807 = program_semester_id#10821)\n                                                :  :  :- Join Inner, (instruction_id#10799L = instruction_id#10806L)\n                                                :  :  :  :- Join Inner, (enrollment_id#10796L = enrollment_id#10798L)\n                                                :  :  :  :  :- Join Inner, (student_id#10786 = student_id#10795)\n                                                :  :  :  :  :  :- SubqueryAlias s\n                                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n                                                :  :  :  :  :  :     +- RelationV2[student_id#10786, student_name#10787, class_name#10788, edu_mail#10789, address_id#10790L, national_id#10791L, key_year#10792, gender#10793, student_dob#10794] iceberg.warehouse.student iceberg.warehouse.student\n                                                :  :  :  :  :  +- SubqueryAlias es\n                                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n                                                :  :  :  :  :        +- RelationV2[student_id#10795, enrollment_id#10796L, enrollment_time#10797] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n                                                :  :  :  :  +- SubqueryAlias ef\n                                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n                                                :  :  :  :        +- RelationV2[enrollment_id#10798L, instruction_id#10799L, enrollment_start_time#10800, enrollment_end_time#10801, enrollment_class#10802, enrollment_status#10803, last_modified_date#10804, etl_date#10805] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n                                                :  :  :  +- SubqueryAlias inf\n                                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n                                                :  :  :        +- RelationV2[instruction_id#10806L, program_semester_id#10807, course_id#10808L, class_id#10809L, is_required#10810, num_student#10811L, num_pass_student#10812L, num_fail_student#10813L, avg_final_score#10814, instruction_status#10815, instruction_allocate#10816, instruction_time_start#10817, instruction_time_end#10818, last_modified_date#10819, etl_date#10820] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n                                                :  :  +- SubqueryAlias ps\n                                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n                                                :  :        +- RelationV2[program_semester_id#10821, program_id#10822, semester_name#10823, total_credit#10824L, required_credit#10825L, elective_credit#10826L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n                                                :  +- SubqueryAlias c\n                                                :     +- SubqueryAlias iceberg.warehouse.course\n                                                :        +- RelationV2[course_id#10827L, course_name#10828, course_code#10829L, category#10830, total_credit#10831L, theory_credit#10832L, practice_credit#10833L, self_learning_credit#10834L] iceberg.warehouse.course iceberg.warehouse.course\n                                                +- SubqueryAlias sf\n                                                   +- SubqueryAlias iceberg.warehouse.score_fact\n                                                      +- RelationV2[score_id#10835L, instruction_id#10836L, student_id#10837, final_score#10838, final_score_4#10839, academic_rank#10840, is_practice#10841, last_modified_date#10842, etl_date#10843] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n:150:115", 'org.apache.spark.sql.errors.QueryCompilationErrors$:unresolvedAttributeError:QueryCompilationErrors.scala:307', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:org$apache$spark$sql$catalyst$analysis$CheckAnalysis$$failUnresolvedAttribute:CheckAnalysis.scala:147', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$6:CheckAnalysis.scala:266', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$6$adapted:CheckAnalysis.scala:264', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:244', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.mutable.ResizableArray:foreach:ResizableArray.scala:62', 'scala.collection.mutable.ResizableArray:foreach$:ResizableArray.scala:55', 'scala.collection.mutable.ArrayBuffer:foreach:ArrayBuffer.scala:49', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.mutable.ResizableArray:foreach:ResizableArray.scala:62', 'scala.collection.mutable.ResizableArray:foreach$:ResizableArray.scala:55', 'scala.collection.mutable.ArrayBuffer:foreach:ArrayBuffer.scala:49', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.mutable.ResizableArray:foreach:ResizableArray.scala:62', 'scala.collection.mutable.ResizableArray:foreach$:ResizableArray.scala:55', 'scala.collection.mutable.ArrayBuffer:foreach:ArrayBuffer.scala:49', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$5:CheckAnalysis.scala:264', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$5$adapted:CheckAnalysis.scala:264', 'scala.collection.immutable.List:foreach:List.scala:431', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$2:CheckAnalysis.scala:264', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$2$adapted:CheckAnalysis.scala:182', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:244', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.immutable.List:foreach:List.scala:431', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis0:CheckAnalysis.scala:182', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis0$:CheckAnalysis.scala:164', 'org.apache.spark.sql.catalyst.analysis.Analyzer:checkAnalysis0:Analyzer.scala:188', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis:CheckAnalysis.scala:160', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis$:CheckAnalysis.scala:150', 'org.apache.spark.sql.catalyst.analysis.Analyzer:checkAnalysis:Analyzer.scala:188', 'org.apache.spark.sql.catalyst.analysis.Analyzer:$anonfun$executeAndCheck$1:Analyzer.scala:211', 'org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$:markInAnalyzer:AnalysisHelper.scala:330', 'org.apache.spark.sql.catalyst.analysis.Analyzer:executeAndCheck:Analyzer.scala:208', 'org.apache.spark.sql.execution.QueryExecution:$anonfun$analyzed$1:QueryExecution.scala:77', 'org.apache.spark.sql.catalyst.QueryPlanningTracker:measurePhase:QueryPlanningTracker.scala:138', 'org.apache.spark.sql.execution.QueryExecution:$anonfun$executePhase$2:QueryExecution.scala:219', 'org.apache.spark.sql.execution.QueryExecution$:withInternalError:QueryExecution.scala:546', 'org.apache.spark.sql.execution.QueryExecution:$anonfun$executePhase$1:QueryExecution.scala:219', 'org.apache.spark.sql.SparkSession:withActive:SparkSession.scala:900', 'org.apache.spark.sql.execution.QueryExecution:executePhase:QueryExecution.scala:218', 'org.apache.spark.sql.execution.QueryExecution:analyzed$lzycompute:QueryExecution.scala:77', 'org.apache.spark.sql.execution.QueryExecution:analyzed:QueryExecution.scala:74', 'org.apache.spark.sql.execution.QueryExecution:assertAnalyzed:QueryExecution.scala:66', 'org.apache.spark.sql.Dataset$:$anonfun$ofRows$2:Dataset.scala:99', 'org.apache.spark.sql.SparkSession:withActive:SparkSession.scala:900', 'org.apache.spark.sql.Dataset$:ofRows:Dataset.scala:97', 'org.apache.spark.sql.SparkSession:$anonfun$sql$4:SparkSession.scala:691', 'org.apache.spark.sql.SparkSession:withActive:SparkSession.scala:900', 'org.apache.spark.sql.SparkSession:sql:SparkSession.scala:682', 'org.apache.spark.sql.SparkSession:sql:SparkSession.scala:713', 'org.apache.spark.sql.SparkSession:sql:SparkSession.scala:744', 'org.apache.spark.sql.SQLContext:sql:SQLContext.scala:651', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:org$apache$spark$sql$hive$thriftserver$SparkExecuteStatementOperation$$execute:SparkExecuteStatementOperation.scala:227'], sqlState='42703', errorCode=0, errorMessage="Error running query: [UNRESOLVED_COLUMN.WITH_SUGGESTION] org.apache.spark.sql.AnalysisException: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `scp`.`final_score` cannot be resolved. Did you mean one of the following? [`scp`.`category`, `scp`.`course_code`, `scp`.`total_credit`, `scp`.`program_id`, `scp`.`student_id`].; line 73 pos 31;\n'ReplaceTableAsSelect TableSpec(Map(),Some(parquet),Map(),None,None,None,false), true, false\n:- ResolvedIdentifier org.apache.iceberg.spark.SparkCatalog@2c3ff8ee, aggr_warehouse.student_program_completion\n+- 'Project ['sc.student_id, 'sc.student_name, 'sc.program_id, 'sc.total_required_credit, 'sc.total_elective_credit, 'sc.total_required_credit_registered, 'sc.total_elective_credit_registered, 'sc.total_required_credit_passed, 'sc.total_elective_credit_passed, CASE WHEN (('sc.total_required_credit_passed >= 'sc.total_required_credit) AND ('sc.total_elective_credit_passed >= 'sc.total_elective_credit)) THEN Completed ELSE Not Completed END AS completion_status#10593]\n   +- 'SubqueryAlias sc\n      +- 'SubqueryAlias aggregated_student_courses\n         +- 'Aggregate [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L], [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L, coalesce(sum(CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_required_credit_registered#10629L, coalesce(sum(CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_elective_credit_registered#10630L, 'COALESCE('SUM((CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed#10631, 'COALESCE('SUM((CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed#10638]\n            +- Join LeftOuter, (((student_id#10647 = student_id#10786) AND (course_code#10762L = course_code#10829L)) AND (program_id#10744 = program_id#10822))\n               :- Join Inner, (program_id#10744 = program_id#10781)\n               :  :- SubqueryAlias scp\n               :  :  +- SubqueryAlias student_courses_registered\n               :  :     +- Distinct\n               :  :        +- Project [student_id#10647, student_name#10648, program_id#10744, course_code#10762L, category#10763, total_credit#10764L]\n               :  :           +- SubqueryAlias lss\n               :  :              +- SubqueryAlias latest_student_scores\n               :  :                 +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, attempt_rank#10628]\n               :  :                    +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697, attempt_rank#10628, attempt_rank#10628]\n               :  :                       +- Window [row_number() windowspecdefinition(student_id#10647, course_code#10762L, instruction_time_end#10697 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10647, course_code#10762L], [instruction_time_end#10697 DESC NULLS LAST]\n               :  :                          +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697]\n               :  :                             +- Join LeftOuter, ((instruction_id#10772L = instruction_id#10685L) AND (student_id#10773 = student_id#10647))\n               :  :                                :- Join Inner, (course_id#10687L = course_id#10760L)\n               :  :                                :  :- Join Inner, (program_semester_id#10686 = program_semester_id#10743)\n               :  :                                :  :  :- Join Inner, (instruction_id#10678L = instruction_id#10685L)\n               :  :                                :  :  :  :- Join Inner, (enrollment_id#10673L = enrollment_id#10677L)\n               :  :                                :  :  :  :  :- Join Inner, (student_id#10647 = student_id#10672)\n               :  :                                :  :  :  :  :  :- SubqueryAlias s\n               :  :                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n               :  :                                :  :  :  :  :  :     +- RelationV2[student_id#10647, student_name#10648, class_name#10649, edu_mail#10650, address_id#10651L, national_id#10652L, key_year#10653, gender#10654, student_dob#10655] iceberg.warehouse.student iceberg.warehouse.student\n               :  :                                :  :  :  :  :  +- SubqueryAlias es\n               :  :                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  :        +- RelationV2[student_id#10672, enrollment_id#10673L, enrollment_time#10674] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  +- SubqueryAlias ef\n               :  :                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  :        +- RelationV2[enrollment_id#10677L, instruction_id#10678L, enrollment_start_time#10679, enrollment_end_time#10680, enrollment_class#10681, enrollment_status#10682, last_modified_date#10683, etl_date#10684] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  +- SubqueryAlias inf\n               :  :                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n               :  :                                :  :  :        +- RelationV2[instruction_id#10685L, program_semester_id#10686, course_id#10687L, class_id#10688L, is_required#10689, num_student#10690L, num_pass_student#10691L, num_fail_student#10692L, avg_final_score#10693, instruction_status#10694, instruction_allocate#10695, instruction_time_start#10696, instruction_time_end#10697, last_modified_date#10698, etl_date#10699] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n               :  :                                :  :  +- SubqueryAlias ps\n               :  :                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n               :  :                                :  :        +- RelationV2[program_semester_id#10743, program_id#10744, semester_name#10745, total_credit#10746L, required_credit#10747L, elective_credit#10748L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               :  :                                :  +- SubqueryAlias c\n               :  :                                :     +- SubqueryAlias iceberg.warehouse.course\n               :  :                                :        +- RelationV2[course_id#10760L, course_name#10761, course_code#10762L, category#10763, total_credit#10764L, theory_credit#10765L, practice_credit#10766L, self_learning_credit#10767L] iceberg.warehouse.course iceberg.warehouse.course\n               :  :                                +- SubqueryAlias sf\n               :  :                                   +- SubqueryAlias iceberg.warehouse.score_fact\n               :  :                                      +- RelationV2[score_id#10771L, instruction_id#10772L, student_id#10773, final_score#10774, final_score_4#10775, academic_rank#10776, is_practice#10777, last_modified_date#10778, etl_date#10779] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n               :  +- SubqueryAlias pr\n               :     +- SubqueryAlias program_requirements\n               :        +- Aggregate [program_id#10781], [program_id#10781, sum(required_credit#10784L) AS total_required_credit#10594L, sum(elective_credit#10785L) AS total_elective_credit#10595L]\n               :           +- SubqueryAlias ps\n               :              +- SubqueryAlias iceberg.warehouse.program_semester\n               :                 +- RelationV2[program_semester_id#10780, program_id#10781, semester_name#10782, total_credit#10783L, required_credit#10784L, elective_credit#10785L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               +- SubqueryAlias scp_passed\n                  +- SubqueryAlias student_courses_passed\n                     +- Project [student_id#10786, student_name#10787, program_id#10822, course_code#10829L, category#10830, total_credit#10831L]\n                        +- Filter ((attempt_rank#10628 = 1) AND (final_score#10838 >= cast(4 as double)))\n                           +- SubqueryAlias lss\n                              +- SubqueryAlias latest_student_scores\n                                 +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, attempt_rank#10628]\n                                    +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818, attempt_rank#10628, attempt_rank#10628]\n                                       +- Window [row_number() windowspecdefinition(student_id#10786, course_code#10829L, instruction_time_end#10818 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10786, course_code#10829L], [instruction_time_end#10818 DESC NULLS LAST]\n                                          +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818]\n                                             +- Join LeftOuter, ((instruction_id#10836L = instruction_id#10806L) AND (student_id#10837 = student_id#10786))\n                                                :- Join Inner, (course_id#10808L = course_id#10827L)\n                                                :  :- Join Inner, (program_semester_id#10807 = program_semester_id#10821)\n                                                :  :  :- Join Inner, (instruction_id#10799L = instruction_id#10806L)\n                                                :  :  :  :- Join Inner, (enrollment_id#10796L = enrollment_id#10798L)\n                                                :  :  :  :  :- Join Inner, (student_id#10786 = student_id#10795)\n                                                :  :  :  :  :  :- SubqueryAlias s\n                                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n                                                :  :  :  :  :  :     +- RelationV2[student_id#10786, student_name#10787, class_name#10788, edu_mail#10789, address_id#10790L, national_id#10791L, key_year#10792, gender#10793, student_dob#10794] iceberg.warehouse.student iceberg.warehouse.student\n                                                :  :  :  :  :  +- SubqueryAlias es\n                                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n                                                :  :  :  :  :        +- RelationV2[student_id#10795, enrollment_id#10796L, enrollment_time#10797] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n                                                :  :  :  :  +- SubqueryAlias ef\n                                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n                                                :  :  :  :        +- RelationV2[enrollment_id#10798L, instruction_id#10799L, enrollment_start_time#10800, enrollment_end_time#10801, enrollment_class#10802, enrollment_status#10803, last_modified_date#10804, etl_date#10805] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n                                                :  :  :  +- SubqueryAlias inf\n                                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n                                                :  :  :        +- RelationV2[instruction_id#10806L, program_semester_id#10807, course_id#10808L, class_id#10809L, is_required#10810, num_student#10811L, num_pass_student#10812L, num_fail_student#10813L, avg_final_score#10814, instruction_status#10815, instruction_allocate#10816, instruction_time_start#10817, instruction_time_end#10818, last_modified_date#10819, etl_date#10820] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n                                                :  :  +- SubqueryAlias ps\n                                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n                                                :  :        +- RelationV2[program_semester_id#10821, program_id#10822, semester_name#10823, total_credit#10824L, required_credit#10825L, elective_credit#10826L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n                                                :  +- SubqueryAlias c\n                                                :     +- SubqueryAlias iceberg.warehouse.course\n                                                :        +- RelationV2[course_id#10827L, course_name#10828, course_code#10829L, category#10830, total_credit#10831L, theory_credit#10832L, practice_credit#10833L, self_learning_credit#10834L] iceberg.warehouse.course iceberg.warehouse.course\n                                                +- SubqueryAlias sf\n                                                   +- SubqueryAlias iceberg.warehouse.score_fact\n                                                      +- RelationV2[score_id#10835L, instruction_id#10836L, student_id#10837, final_score#10838, final_score_4#10839, academic_rank#10840, is_practice#10841, last_modified_date#10842, etl_date#10843] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n"), operationHandle=None)
[2024-12-17T05:26:36.553+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=etl_score_fact_data, task_id=aggregate_warehouse.aggregate_student_program_completion, run_id=manual__2024-12-17T05:25:56.018426+00:00, execution_date=20241217T052556, start_date=20241217T052630, end_date=20241217T052636
[2024-12-17T05:26:36.581+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 893 for task aggregate_warehouse.aggregate_student_program_completion (TExecuteStatementResp(status=TStatus(statusCode=3, infoMessages=["*org.apache.hive.service.cli.HiveSQLException:Error running query: [UNRESOLVED_COLUMN.WITH_SUGGESTION] org.apache.spark.sql.AnalysisException: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `scp`.`final_score` cannot be resolved. Did you mean one of the following? [`scp`.`category`, `scp`.`course_code`, `scp`.`total_credit`, `scp`.`program_id`, `scp`.`student_id`].; line 73 pos 31;\n'ReplaceTableAsSelect TableSpec(Map(),Some(parquet),Map(),None,None,None,false), true, false\n:- ResolvedIdentifier org.apache.iceberg.spark.SparkCatalog@2c3ff8ee, aggr_warehouse.student_program_completion\n+- 'Project ['sc.student_id, 'sc.student_name, 'sc.program_id, 'sc.total_required_credit, 'sc.total_elective_credit, 'sc.total_required_credit_registered, 'sc.total_elective_credit_registered, 'sc.total_required_credit_passed, 'sc.total_elective_credit_passed, CASE WHEN (('sc.total_required_credit_passed >= 'sc.total_required_credit) AND ('sc.total_elective_credit_passed >= 'sc.total_elective_credit)) THEN Completed ELSE Not Completed END AS completion_status#10593]\n   +- 'SubqueryAlias sc\n      +- 'SubqueryAlias aggregated_student_courses\n         +- 'Aggregate [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L], [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L, coalesce(sum(CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_required_credit_registered#10629L, coalesce(sum(CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_elective_credit_registered#10630L, 'COALESCE('SUM((CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed#10631, 'COALESCE('SUM((CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed#10638]\n            +- Join LeftOuter, (((student_id#10647 = student_id#10786) AND (course_code#10762L = course_code#10829L)) AND (program_id#10744 = program_id#10822))\n               :- Join Inner, (program_id#10744 = program_id#10781)\n               :  :- SubqueryAlias scp\n               :  :  +- SubqueryAlias student_courses_registered\n               :  :     +- Distinct\n               :  :        +- Project [student_id#10647, student_name#10648, program_id#10744, course_code#10762L, category#10763, total_credit#10764L]\n               :  :           +- SubqueryAlias lss\n               :  :              +- SubqueryAlias latest_student_scores\n               :  :                 +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, attempt_rank#10628]\n               :  :                    +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697, attempt_rank#10628, attempt_rank#10628]\n               :  :                       +- Window [row_number() windowspecdefinition(student_id#10647, course_code#10762L, instruction_time_end#10697 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10647, course_code#10762L], [instruction_time_end#10697 DESC NULLS LAST]\n               :  :                          +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697]\n               :  :                             +- Join LeftOuter, ((instruction_id#10772L = instruction_id#10685L) AND (student_id#10773 = student_id#10647))\n               :  :                                :- Join Inner, (course_id#10687L = course_id#10760L)\n               :  :                                :  :- Join Inner, (program_semester_id#10686 = program_semester_id#10743)\n               :  :                                :  :  :- Join Inner, (instruction_id#10678L = instruction_id#10685L)\n               :  :                                :  :  :  :- Join Inner, (enrollment_id#10673L = enrollment_id#10677L)\n               :  :                                :  :  :  :  :- Join Inner, (student_id#10647 = student_id#10672)\n               :  :                                :  :  :  :  :  :- SubqueryAlias s\n               :  :                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n               :  :                                :  :  :  :  :  :     +- RelationV2[student_id#10647, student_name#10648, class_name#10649, edu_mail#10650, address_id#10651L, national_id#10652L, key_year#10653, gender#10654, student_dob#10655] iceberg.warehouse.student iceberg.warehouse.student\n               :  :                                :  :  :  :  :  +- SubqueryAlias es\n               :  :                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  :        +- RelationV2[student_id#10672, enrollment_id#10673L, enrollment_time#10674] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  +- SubqueryAlias ef\n               :  :                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  :        +- RelationV2[enrollment_id#10677L, instruction_id#10678L, enrollment_start_time#10679, enrollment_end_time#10680, enrollment_class#10681, enrollment_status#10682, last_modified_date#10683, etl_date#10684] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  +- SubqueryAlias inf\n               :  :                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n               :  :                                :  :  :        +- RelationV2[instruction_id#10685L, program_semester_id#10686, course_id#10687L, class_id#10688L, is_required#10689, num_student#10690L, num_pass_student#10691L, num_fail_student#10692L, avg_final_score#10693, instruction_status#10694, instruction_allocate#10695, instruction_time_start#10696, instruction_time_end#10697, last_modified_date#10698, etl_date#10699] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n               :  :                                :  :  +- SubqueryAlias ps\n               :  :                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n               :  :                                :  :        +- RelationV2[program_semester_id#10743, program_id#10744, semester_name#10745, total_credit#10746L, required_credit#10747L, elective_credit#10748L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               :  :                                :  +- SubqueryAlias c\n               :  :                                :     +- SubqueryAlias iceberg.warehouse.course\n               :  :                                :        +- RelationV2[course_id#10760L, course_name#10761, course_code#10762L, category#10763, total_credit#10764L, theory_credit#10765L, practice_credit#10766L, self_learning_credit#10767L] iceberg.warehouse.course iceberg.warehouse.course\n               :  :                                +- SubqueryAlias sf\n               :  :                                   +- SubqueryAlias iceberg.warehouse.score_fact\n               :  :                                      +- RelationV2[score_id#10771L, instruction_id#10772L, student_id#10773, final_score#10774, final_score_4#10775, academic_rank#10776, is_practice#10777, last_modified_date#10778, etl_date#10779] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n               :  +- SubqueryAlias pr\n               :     +- SubqueryAlias program_requirements\n               :        +- Aggregate [program_id#10781], [program_id#10781, sum(required_credit#10784L) AS total_required_credit#10594L, sum(elective_credit#10785L) AS total_elective_credit#10595L]\n               :           +- SubqueryAlias ps\n               :              +- SubqueryAlias iceberg.warehouse.program_semester\n               :                 +- RelationV2[program_semester_id#10780, program_id#10781, semester_name#10782, total_credit#10783L, required_credit#10784L, elective_credit#10785L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               +- SubqueryAlias scp_passed\n                  +- SubqueryAlias student_courses_passed\n                     +- Project [student_id#10786, student_name#10787, program_id#10822, course_code#10829L, category#10830, total_credit#10831L]\n                        +- Filter ((attempt_rank#10628 = 1) AND (final_score#10838 >= cast(4 as double)))\n                           +- SubqueryAlias lss\n                              +- SubqueryAlias latest_student_scores\n                                 +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, attempt_rank#10628]\n                                    +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818, attempt_rank#10628, attempt_rank#10628]\n                                       +- Window [row_number() windowspecdefinition(student_id#10786, course_code#10829L, instruction_time_end#10818 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10786, course_code#10829L], [instruction_time_end#10818 DESC NULLS LAST]\n                                          +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818]\n                                             +- Join LeftOuter, ((instruction_id#10836L = instruction_id#10806L) AND (student_id#10837 = student_id#10786))\n                                                :- Join Inner, (course_id#10808L = course_id#10827L)\n                                                :  :- Join Inner, (program_semester_id#10807 = program_semester_id#10821)\n                                                :  :  :- Join Inner, (instruction_id#10799L = instruction_id#10806L)\n                                                :  :  :  :- Join Inner, (enrollment_id#10796L = enrollment_id#10798L)\n                                                :  :  :  :  :- Join Inner, (student_id#10786 = student_id#10795)\n                                                :  :  :  :  :  :- SubqueryAlias s\n                                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n                                                :  :  :  :  :  :     +- RelationV2[student_id#10786, student_name#10787, class_name#10788, edu_mail#10789, address_id#10790L, national_id#10791L, key_year#10792, gender#10793, student_dob#10794] iceberg.warehouse.student iceberg.warehouse.student\n                                                :  :  :  :  :  +- SubqueryAlias es\n                                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n                                                :  :  :  :  :        +- RelationV2[student_id#10795, enrollment_id#10796L, enrollment_time#10797] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n                                                :  :  :  :  +- SubqueryAlias ef\n                                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n                                                :  :  :  :        +- RelationV2[enrollment_id#10798L, instruction_id#10799L, enrollment_start_time#10800, enrollment_end_time#10801, enrollment_class#10802, enrollment_status#10803, last_modified_date#10804, etl_date#10805] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n                                                :  :  :  +- SubqueryAlias inf\n                                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n                                                :  :  :        +- RelationV2[instruction_id#10806L, program_semester_id#10807, course_id#10808L, class_id#10809L, is_required#10810, num_student#10811L, num_pass_student#10812L, num_fail_student#10813L, avg_final_score#10814, instruction_status#10815, instruction_allocate#10816, instruction_time_start#10817, instruction_time_end#10818, last_modified_date#10819, etl_date#10820] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n                                                :  :  +- SubqueryAlias ps\n                                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n                                                :  :        +- RelationV2[program_semester_id#10821, program_id#10822, semester_name#10823, total_credit#10824L, required_credit#10825L, elective_credit#10826L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n                                                :  +- SubqueryAlias c\n                                                :     +- SubqueryAlias iceberg.warehouse.course\n                                                :        +- RelationV2[course_id#10827L, course_name#10828, course_code#10829L, category#10830, total_credit#10831L, theory_credit#10832L, practice_credit#10833L, self_learning_credit#10834L] iceberg.warehouse.course iceberg.warehouse.course\n                                                +- SubqueryAlias sf\n                                                   +- SubqueryAlias iceberg.warehouse.score_fact\n                                                      +- RelationV2[score_id#10835L, instruction_id#10836L, student_id#10837, final_score#10838, final_score_4#10839, academic_rank#10840, is_practice#10841, last_modified_date#10842, etl_date#10843] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n:36:35", 'org.apache.spark.sql.hive.thriftserver.HiveThriftServerErrors$:runningQueryError:HiveThriftServerErrors.scala:43', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:org$apache$spark$sql$hive$thriftserver$SparkExecuteStatementOperation$$execute:SparkExecuteStatementOperation.scala:262', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:runInternal:SparkExecuteStatementOperation.scala:152', 'org.apache.hive.service.cli.operation.Operation:run:Operation.java:277', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:org$apache$spark$sql$hive$thriftserver$SparkOperation$$super$run:SparkExecuteStatementOperation.scala:41', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:$anonfun$run$1:SparkOperation.scala:45', 'scala.runtime.java8.JFunction0$mcV$sp:apply:JFunction0$mcV$sp.java:23', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:withLocalProperties:SparkOperation.scala:79', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:withLocalProperties$:SparkOperation.scala:63', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:withLocalProperties:SparkExecuteStatementOperation.scala:41', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:run:SparkOperation.scala:45', 'org.apache.spark.sql.hive.thriftserver.SparkOperation:run$:SparkOperation.scala:43', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:run:SparkExecuteStatementOperation.scala:41', 'org.apache.hive.service.cli.session.HiveSessionImpl:executeStatementInternal:HiveSessionImpl.java:484', 'org.apache.hive.service.cli.session.HiveSessionImpl:executeStatement:HiveSessionImpl.java:460', 'jdk.internal.reflect.GeneratedMethodAccessor17:invoke::-1', 'jdk.internal.reflect.DelegatingMethodAccessorImpl:invoke::-1', 'java.lang.reflect.Method:invoke::-1', 'org.apache.hive.service.cli.session.HiveSessionProxy:invoke:HiveSessionProxy.java:71', 'org.apache.hive.service.cli.session.HiveSessionProxy:lambda$invoke$0:HiveSessionProxy.java:58', 'java.security.AccessController:doPrivileged::-2', 'javax.security.auth.Subject:doAs::-1', 'org.apache.hadoop.security.UserGroupInformation:doAs:UserGroupInformation.java:1878', 'org.apache.hive.service.cli.session.HiveSessionProxy:invoke:HiveSessionProxy.java:58', 'com.sun.proxy.$Proxy39:executeStatement::-1', 'org.apache.hive.service.cli.CLIService:executeStatement:CLIService.java:282', 'org.apache.hive.service.cli.thrift.ThriftCLIService:ExecuteStatement:ThriftCLIService.java:453', 'org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement:getResult:TCLIService.java:1557', 'org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement:getResult:TCLIService.java:1542', 'org.apache.thrift.ProcessFunction:process:ProcessFunction.java:38', 'org.apache.thrift.TBaseProcessor:process:TBaseProcessor.java:39', 'org.apache.hive.service.auth.TSetIpAddressProcessor:process:TSetIpAddressProcessor.java:52', 'org.apache.thrift.server.TThreadPoolServer$WorkerProcess:run:TThreadPoolServer.java:310', 'java.util.concurrent.ThreadPoolExecutor:runWorker::-1', 'java.util.concurrent.ThreadPoolExecutor$Worker:run::-1', 'java.lang.Thread:run::-1', "*org.apache.spark.sql.catalyst.ExtendedAnalysisException:[UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `scp`.`final_score` cannot be resolved. Did you mean one of the following? [`scp`.`category`, `scp`.`course_code`, `scp`.`total_credit`, `scp`.`program_id`, `scp`.`student_id`].; line 73 pos 31;\n'ReplaceTableAsSelect TableSpec(Map(),Some(parquet),Map(),None,None,None,false), true, false\n:- ResolvedIdentifier org.apache.iceberg.spark.SparkCatalog@2c3ff8ee, aggr_warehouse.student_program_completion\n+- 'Project ['sc.student_id, 'sc.student_name, 'sc.program_id, 'sc.total_required_credit, 'sc.total_elective_credit, 'sc.total_required_credit_registered, 'sc.total_elective_credit_registered, 'sc.total_required_credit_passed, 'sc.total_elective_credit_passed, CASE WHEN (('sc.total_required_credit_passed >= 'sc.total_required_credit) AND ('sc.total_elective_credit_passed >= 'sc.total_elective_credit)) THEN Completed ELSE Not Completed END AS completion_status#10593]\n   +- 'SubqueryAlias sc\n      +- 'SubqueryAlias aggregated_student_courses\n         +- 'Aggregate [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L], [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L, coalesce(sum(CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_required_credit_registered#10629L, coalesce(sum(CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_elective_credit_registered#10630L, 'COALESCE('SUM((CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed#10631, 'COALESCE('SUM((CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed#10638]\n            +- Join LeftOuter, (((student_id#10647 = student_id#10786) AND (course_code#10762L = course_code#10829L)) AND (program_id#10744 = program_id#10822))\n               :- Join Inner, (program_id#10744 = program_id#10781)\n               :  :- SubqueryAlias scp\n               :  :  +- SubqueryAlias student_courses_registered\n               :  :     +- Distinct\n               :  :        +- Project [student_id#10647, student_name#10648, program_id#10744, course_code#10762L, category#10763, total_credit#10764L]\n               :  :           +- SubqueryAlias lss\n               :  :              +- SubqueryAlias latest_student_scores\n               :  :                 +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, attempt_rank#10628]\n               :  :                    +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697, attempt_rank#10628, attempt_rank#10628]\n               :  :                       +- Window [row_number() windowspecdefinition(student_id#10647, course_code#10762L, instruction_time_end#10697 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10647, course_code#10762L], [instruction_time_end#10697 DESC NULLS LAST]\n               :  :                          +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697]\n               :  :                             +- Join LeftOuter, ((instruction_id#10772L = instruction_id#10685L) AND (student_id#10773 = student_id#10647))\n               :  :                                :- Join Inner, (course_id#10687L = course_id#10760L)\n               :  :                                :  :- Join Inner, (program_semester_id#10686 = program_semester_id#10743)\n               :  :                                :  :  :- Join Inner, (instruction_id#10678L = instruction_id#10685L)\n               :  :                                :  :  :  :- Join Inner, (enrollment_id#10673L = enrollment_id#10677L)\n               :  :                                :  :  :  :  :- Join Inner, (student_id#10647 = student_id#10672)\n               :  :                                :  :  :  :  :  :- SubqueryAlias s\n               :  :                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n               :  :                                :  :  :  :  :  :     +- RelationV2[student_id#10647, student_name#10648, class_name#10649, edu_mail#10650, address_id#10651L, national_id#10652L, key_year#10653, gender#10654, student_dob#10655] iceberg.warehouse.student iceberg.warehouse.student\n               :  :                                :  :  :  :  :  +- SubqueryAlias es\n               :  :                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  :        +- RelationV2[student_id#10672, enrollment_id#10673L, enrollment_time#10674] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  +- SubqueryAlias ef\n               :  :                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  :        +- RelationV2[enrollment_id#10677L, instruction_id#10678L, enrollment_start_time#10679, enrollment_end_time#10680, enrollment_class#10681, enrollment_status#10682, last_modified_date#10683, etl_date#10684] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  +- SubqueryAlias inf\n               :  :                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n               :  :                                :  :  :        +- RelationV2[instruction_id#10685L, program_semester_id#10686, course_id#10687L, class_id#10688L, is_required#10689, num_student#10690L, num_pass_student#10691L, num_fail_student#10692L, avg_final_score#10693, instruction_status#10694, instruction_allocate#10695, instruction_time_start#10696, instruction_time_end#10697, last_modified_date#10698, etl_date#10699] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n               :  :                                :  :  +- SubqueryAlias ps\n               :  :                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n               :  :                                :  :        +- RelationV2[program_semester_id#10743, program_id#10744, semester_name#10745, total_credit#10746L, required_credit#10747L, elective_credit#10748L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               :  :                                :  +- SubqueryAlias c\n               :  :                                :     +- SubqueryAlias iceberg.warehouse.course\n               :  :                                :        +- RelationV2[course_id#10760L, course_name#10761, course_code#10762L, category#10763, total_credit#10764L, theory_credit#10765L, practice_credit#10766L, self_learning_credit#10767L] iceberg.warehouse.course iceberg.warehouse.course\n               :  :                                +- SubqueryAlias sf\n               :  :                                   +- SubqueryAlias iceberg.warehouse.score_fact\n               :  :                                      +- RelationV2[score_id#10771L, instruction_id#10772L, student_id#10773, final_score#10774, final_score_4#10775, academic_rank#10776, is_practice#10777, last_modified_date#10778, etl_date#10779] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n               :  +- SubqueryAlias pr\n               :     +- SubqueryAlias program_requirements\n               :        +- Aggregate [program_id#10781], [program_id#10781, sum(required_credit#10784L) AS total_required_credit#10594L, sum(elective_credit#10785L) AS total_elective_credit#10595L]\n               :           +- SubqueryAlias ps\n               :              +- SubqueryAlias iceberg.warehouse.program_semester\n               :                 +- RelationV2[program_semester_id#10780, program_id#10781, semester_name#10782, total_credit#10783L, required_credit#10784L, elective_credit#10785L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               +- SubqueryAlias scp_passed\n                  +- SubqueryAlias student_courses_passed\n                     +- Project [student_id#10786, student_name#10787, program_id#10822, course_code#10829L, category#10830, total_credit#10831L]\n                        +- Filter ((attempt_rank#10628 = 1) AND (final_score#10838 >= cast(4 as double)))\n                           +- SubqueryAlias lss\n                              +- SubqueryAlias latest_student_scores\n                                 +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, attempt_rank#10628]\n                                    +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818, attempt_rank#10628, attempt_rank#10628]\n                                       +- Window [row_number() windowspecdefinition(student_id#10786, course_code#10829L, instruction_time_end#10818 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10786, course_code#10829L], [instruction_time_end#10818 DESC NULLS LAST]\n                                          +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818]\n                                             +- Join LeftOuter, ((instruction_id#10836L = instruction_id#10806L) AND (student_id#10837 = student_id#10786))\n                                                :- Join Inner, (course_id#10808L = course_id#10827L)\n                                                :  :- Join Inner, (program_semester_id#10807 = program_semester_id#10821)\n                                                :  :  :- Join Inner, (instruction_id#10799L = instruction_id#10806L)\n                                                :  :  :  :- Join Inner, (enrollment_id#10796L = enrollment_id#10798L)\n                                                :  :  :  :  :- Join Inner, (student_id#10786 = student_id#10795)\n                                                :  :  :  :  :  :- SubqueryAlias s\n                                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n                                                :  :  :  :  :  :     +- RelationV2[student_id#10786, student_name#10787, class_name#10788, edu_mail#10789, address_id#10790L, national_id#10791L, key_year#10792, gender#10793, student_dob#10794] iceberg.warehouse.student iceberg.warehouse.student\n                                                :  :  :  :  :  +- SubqueryAlias es\n                                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n                                                :  :  :  :  :        +- RelationV2[student_id#10795, enrollment_id#10796L, enrollment_time#10797] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n                                                :  :  :  :  +- SubqueryAlias ef\n                                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n                                                :  :  :  :        +- RelationV2[enrollment_id#10798L, instruction_id#10799L, enrollment_start_time#10800, enrollment_end_time#10801, enrollment_class#10802, enrollment_status#10803, last_modified_date#10804, etl_date#10805] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n                                                :  :  :  +- SubqueryAlias inf\n                                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n                                                :  :  :        +- RelationV2[instruction_id#10806L, program_semester_id#10807, course_id#10808L, class_id#10809L, is_required#10810, num_student#10811L, num_pass_student#10812L, num_fail_student#10813L, avg_final_score#10814, instruction_status#10815, instruction_allocate#10816, instruction_time_start#10817, instruction_time_end#10818, last_modified_date#10819, etl_date#10820] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n                                                :  :  +- SubqueryAlias ps\n                                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n                                                :  :        +- RelationV2[program_semester_id#10821, program_id#10822, semester_name#10823, total_credit#10824L, required_credit#10825L, elective_credit#10826L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n                                                :  +- SubqueryAlias c\n                                                :     +- SubqueryAlias iceberg.warehouse.course\n                                                :        +- RelationV2[course_id#10827L, course_name#10828, course_code#10829L, category#10830, total_credit#10831L, theory_credit#10832L, practice_credit#10833L, self_learning_credit#10834L] iceberg.warehouse.course iceberg.warehouse.course\n                                                +- SubqueryAlias sf\n                                                   +- SubqueryAlias iceberg.warehouse.score_fact\n                                                      +- RelationV2[score_id#10835L, instruction_id#10836L, student_id#10837, final_score#10838, final_score_4#10839, academic_rank#10840, is_practice#10841, last_modified_date#10842, etl_date#10843] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n:150:115", 'org.apache.spark.sql.errors.QueryCompilationErrors$:unresolvedAttributeError:QueryCompilationErrors.scala:307', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:org$apache$spark$sql$catalyst$analysis$CheckAnalysis$$failUnresolvedAttribute:CheckAnalysis.scala:147', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$6:CheckAnalysis.scala:266', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$6$adapted:CheckAnalysis.scala:264', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:244', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.mutable.ResizableArray:foreach:ResizableArray.scala:62', 'scala.collection.mutable.ResizableArray:foreach$:ResizableArray.scala:55', 'scala.collection.mutable.ArrayBuffer:foreach:ArrayBuffer.scala:49', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.mutable.ResizableArray:foreach:ResizableArray.scala:62', 'scala.collection.mutable.ResizableArray:foreach$:ResizableArray.scala:55', 'scala.collection.mutable.ArrayBuffer:foreach:ArrayBuffer.scala:49', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.mutable.ResizableArray:foreach:ResizableArray.scala:62', 'scala.collection.mutable.ResizableArray:foreach$:ResizableArray.scala:55', 'scala.collection.mutable.ArrayBuffer:foreach:ArrayBuffer.scala:49', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$5:CheckAnalysis.scala:264', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$5$adapted:CheckAnalysis.scala:264', 'scala.collection.immutable.List:foreach:List.scala:431', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$2:CheckAnalysis.scala:264', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:$anonfun$checkAnalysis0$2$adapted:CheckAnalysis.scala:182', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:244', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.Iterator:foreach:Iterator.scala:943', 'scala.collection.Iterator:foreach$:Iterator.scala:943', 'scala.collection.AbstractIterator:foreach:Iterator.scala:1431', 'scala.collection.IterableLike:foreach:IterableLike.scala:74', 'scala.collection.IterableLike:foreach$:IterableLike.scala:73', 'scala.collection.AbstractIterable:foreach:Iterable.scala:56', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.trees.TreeNode:$anonfun$foreachUp$1$adapted:TreeNode.scala:243', 'scala.collection.immutable.List:foreach:List.scala:431', 'org.apache.spark.sql.catalyst.trees.TreeNode:foreachUp:TreeNode.scala:243', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis0:CheckAnalysis.scala:182', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis0$:CheckAnalysis.scala:164', 'org.apache.spark.sql.catalyst.analysis.Analyzer:checkAnalysis0:Analyzer.scala:188', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis:CheckAnalysis.scala:160', 'org.apache.spark.sql.catalyst.analysis.CheckAnalysis:checkAnalysis$:CheckAnalysis.scala:150', 'org.apache.spark.sql.catalyst.analysis.Analyzer:checkAnalysis:Analyzer.scala:188', 'org.apache.spark.sql.catalyst.analysis.Analyzer:$anonfun$executeAndCheck$1:Analyzer.scala:211', 'org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$:markInAnalyzer:AnalysisHelper.scala:330', 'org.apache.spark.sql.catalyst.analysis.Analyzer:executeAndCheck:Analyzer.scala:208', 'org.apache.spark.sql.execution.QueryExecution:$anonfun$analyzed$1:QueryExecution.scala:77', 'org.apache.spark.sql.catalyst.QueryPlanningTracker:measurePhase:QueryPlanningTracker.scala:138', 'org.apache.spark.sql.execution.QueryExecution:$anonfun$executePhase$2:QueryExecution.scala:219', 'org.apache.spark.sql.execution.QueryExecution$:withInternalError:QueryExecution.scala:546', 'org.apache.spark.sql.execution.QueryExecution:$anonfun$executePhase$1:QueryExecution.scala:219', 'org.apache.spark.sql.SparkSession:withActive:SparkSession.scala:900', 'org.apache.spark.sql.execution.QueryExecution:executePhase:QueryExecution.scala:218', 'org.apache.spark.sql.execution.QueryExecution:analyzed$lzycompute:QueryExecution.scala:77', 'org.apache.spark.sql.execution.QueryExecution:analyzed:QueryExecution.scala:74', 'org.apache.spark.sql.execution.QueryExecution:assertAnalyzed:QueryExecution.scala:66', 'org.apache.spark.sql.Dataset$:$anonfun$ofRows$2:Dataset.scala:99', 'org.apache.spark.sql.SparkSession:withActive:SparkSession.scala:900', 'org.apache.spark.sql.Dataset$:ofRows:Dataset.scala:97', 'org.apache.spark.sql.SparkSession:$anonfun$sql$4:SparkSession.scala:691', 'org.apache.spark.sql.SparkSession:withActive:SparkSession.scala:900', 'org.apache.spark.sql.SparkSession:sql:SparkSession.scala:682', 'org.apache.spark.sql.SparkSession:sql:SparkSession.scala:713', 'org.apache.spark.sql.SparkSession:sql:SparkSession.scala:744', 'org.apache.spark.sql.SQLContext:sql:SQLContext.scala:651', 'org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation:org$apache$spark$sql$hive$thriftserver$SparkExecuteStatementOperation$$execute:SparkExecuteStatementOperation.scala:227'], sqlState='42703', errorCode=0, errorMessage="Error running query: [UNRESOLVED_COLUMN.WITH_SUGGESTION] org.apache.spark.sql.AnalysisException: [UNRESOLVED_COLUMN.WITH_SUGGESTION] A column or function parameter with name `scp`.`final_score` cannot be resolved. Did you mean one of the following? [`scp`.`category`, `scp`.`course_code`, `scp`.`total_credit`, `scp`.`program_id`, `scp`.`student_id`].; line 73 pos 31;\n'ReplaceTableAsSelect TableSpec(Map(),Some(parquet),Map(),None,None,None,false), true, false\n:- ResolvedIdentifier org.apache.iceberg.spark.SparkCatalog@2c3ff8ee, aggr_warehouse.student_program_completion\n+- 'Project ['sc.student_id, 'sc.student_name, 'sc.program_id, 'sc.total_required_credit, 'sc.total_elective_credit, 'sc.total_required_credit_registered, 'sc.total_elective_credit_registered, 'sc.total_required_credit_passed, 'sc.total_elective_credit_passed, CASE WHEN (('sc.total_required_credit_passed >= 'sc.total_required_credit) AND ('sc.total_elective_credit_passed >= 'sc.total_elective_credit)) THEN Completed ELSE Not Completed END AS completion_status#10593]\n   +- 'SubqueryAlias sc\n      +- 'SubqueryAlias aggregated_student_courses\n         +- 'Aggregate [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L], [student_id#10647, student_name#10648, program_id#10744, total_required_credit#10594L, total_elective_credit#10595L, coalesce(sum(CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_required_credit_registered#10629L, coalesce(sum(CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END), cast(0 as bigint)) AS total_elective_credit_registered#10630L, 'COALESCE('SUM((CASE WHEN (category#10763 = required) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_required_credit_passed#10631, 'COALESCE('SUM((CASE WHEN (category#10763 = elective) THEN total_credit#10764L ELSE cast(0 as bigint) END * CASE WHEN ('scp.final_score >= 4) THEN 1 ELSE 0 END)), 0) AS total_elective_credit_passed#10638]\n            +- Join LeftOuter, (((student_id#10647 = student_id#10786) AND (course_code#10762L = course_code#10829L)) AND (program_id#10744 = program_id#10822))\n               :- Join Inner, (program_id#10744 = program_id#10781)\n               :  :- SubqueryAlias scp\n               :  :  +- SubqueryAlias student_courses_registered\n               :  :     +- Distinct\n               :  :        +- Project [student_id#10647, student_name#10648, program_id#10744, course_code#10762L, category#10763, total_credit#10764L]\n               :  :           +- SubqueryAlias lss\n               :  :              +- SubqueryAlias latest_student_scores\n               :  :                 +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, attempt_rank#10628]\n               :  :                    +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697, attempt_rank#10628, attempt_rank#10628]\n               :  :                       +- Window [row_number() windowspecdefinition(student_id#10647, course_code#10762L, instruction_time_end#10697 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10647, course_code#10762L], [instruction_time_end#10697 DESC NULLS LAST]\n               :  :                          +- Project [student_id#10647, student_name#10648, program_id#10744, program_semester_id#10743, course_code#10762L, category#10763, total_credit#10764L, final_score#10774, instruction_time_end#10697]\n               :  :                             +- Join LeftOuter, ((instruction_id#10772L = instruction_id#10685L) AND (student_id#10773 = student_id#10647))\n               :  :                                :- Join Inner, (course_id#10687L = course_id#10760L)\n               :  :                                :  :- Join Inner, (program_semester_id#10686 = program_semester_id#10743)\n               :  :                                :  :  :- Join Inner, (instruction_id#10678L = instruction_id#10685L)\n               :  :                                :  :  :  :- Join Inner, (enrollment_id#10673L = enrollment_id#10677L)\n               :  :                                :  :  :  :  :- Join Inner, (student_id#10647 = student_id#10672)\n               :  :                                :  :  :  :  :  :- SubqueryAlias s\n               :  :                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n               :  :                                :  :  :  :  :  :     +- RelationV2[student_id#10647, student_name#10648, class_name#10649, edu_mail#10650, address_id#10651L, national_id#10652L, key_year#10653, gender#10654, student_dob#10655] iceberg.warehouse.student iceberg.warehouse.student\n               :  :                                :  :  :  :  :  +- SubqueryAlias es\n               :  :                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  :        +- RelationV2[student_id#10672, enrollment_id#10673L, enrollment_time#10674] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n               :  :                                :  :  :  :  +- SubqueryAlias ef\n               :  :                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  :        +- RelationV2[enrollment_id#10677L, instruction_id#10678L, enrollment_start_time#10679, enrollment_end_time#10680, enrollment_class#10681, enrollment_status#10682, last_modified_date#10683, etl_date#10684] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n               :  :                                :  :  :  +- SubqueryAlias inf\n               :  :                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n               :  :                                :  :  :        +- RelationV2[instruction_id#10685L, program_semester_id#10686, course_id#10687L, class_id#10688L, is_required#10689, num_student#10690L, num_pass_student#10691L, num_fail_student#10692L, avg_final_score#10693, instruction_status#10694, instruction_allocate#10695, instruction_time_start#10696, instruction_time_end#10697, last_modified_date#10698, etl_date#10699] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n               :  :                                :  :  +- SubqueryAlias ps\n               :  :                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n               :  :                                :  :        +- RelationV2[program_semester_id#10743, program_id#10744, semester_name#10745, total_credit#10746L, required_credit#10747L, elective_credit#10748L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               :  :                                :  +- SubqueryAlias c\n               :  :                                :     +- SubqueryAlias iceberg.warehouse.course\n               :  :                                :        +- RelationV2[course_id#10760L, course_name#10761, course_code#10762L, category#10763, total_credit#10764L, theory_credit#10765L, practice_credit#10766L, self_learning_credit#10767L] iceberg.warehouse.course iceberg.warehouse.course\n               :  :                                +- SubqueryAlias sf\n               :  :                                   +- SubqueryAlias iceberg.warehouse.score_fact\n               :  :                                      +- RelationV2[score_id#10771L, instruction_id#10772L, student_id#10773, final_score#10774, final_score_4#10775, academic_rank#10776, is_practice#10777, last_modified_date#10778, etl_date#10779] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n               :  +- SubqueryAlias pr\n               :     +- SubqueryAlias program_requirements\n               :        +- Aggregate [program_id#10781], [program_id#10781, sum(required_credit#10784L) AS total_required_credit#10594L, sum(elective_credit#10785L) AS total_elective_credit#10595L]\n               :           +- SubqueryAlias ps\n               :              +- SubqueryAlias iceberg.warehouse.program_semester\n               :                 +- RelationV2[program_semester_id#10780, program_id#10781, semester_name#10782, total_credit#10783L, required_credit#10784L, elective_credit#10785L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n               +- SubqueryAlias scp_passed\n                  +- SubqueryAlias student_courses_passed\n                     +- Project [student_id#10786, student_name#10787, program_id#10822, course_code#10829L, category#10830, total_credit#10831L]\n                        +- Filter ((attempt_rank#10628 = 1) AND (final_score#10838 >= cast(4 as double)))\n                           +- SubqueryAlias lss\n                              +- SubqueryAlias latest_student_scores\n                                 +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, attempt_rank#10628]\n                                    +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818, attempt_rank#10628, attempt_rank#10628]\n                                       +- Window [row_number() windowspecdefinition(student_id#10786, course_code#10829L, instruction_time_end#10818 DESC NULLS LAST, specifiedwindowframe(RowFrame, unboundedpreceding$(), currentrow$())) AS attempt_rank#10628], [student_id#10786, course_code#10829L], [instruction_time_end#10818 DESC NULLS LAST]\n                                          +- Project [student_id#10786, student_name#10787, program_id#10822, program_semester_id#10821, course_code#10829L, category#10830, total_credit#10831L, final_score#10838, instruction_time_end#10818]\n                                             +- Join LeftOuter, ((instruction_id#10836L = instruction_id#10806L) AND (student_id#10837 = student_id#10786))\n                                                :- Join Inner, (course_id#10808L = course_id#10827L)\n                                                :  :- Join Inner, (program_semester_id#10807 = program_semester_id#10821)\n                                                :  :  :- Join Inner, (instruction_id#10799L = instruction_id#10806L)\n                                                :  :  :  :- Join Inner, (enrollment_id#10796L = enrollment_id#10798L)\n                                                :  :  :  :  :- Join Inner, (student_id#10786 = student_id#10795)\n                                                :  :  :  :  :  :- SubqueryAlias s\n                                                :  :  :  :  :  :  +- SubqueryAlias iceberg.warehouse.student\n                                                :  :  :  :  :  :     +- RelationV2[student_id#10786, student_name#10787, class_name#10788, edu_mail#10789, address_id#10790L, national_id#10791L, key_year#10792, gender#10793, student_dob#10794] iceberg.warehouse.student iceberg.warehouse.student\n                                                :  :  :  :  :  +- SubqueryAlias es\n                                                :  :  :  :  :     +- SubqueryAlias iceberg.warehouse.enroll_student\n                                                :  :  :  :  :        +- RelationV2[student_id#10795, enrollment_id#10796L, enrollment_time#10797] iceberg.warehouse.enroll_student iceberg.warehouse.enroll_student\n                                                :  :  :  :  +- SubqueryAlias ef\n                                                :  :  :  :     +- SubqueryAlias iceberg.warehouse.enrollment_fact\n                                                :  :  :  :        +- RelationV2[enrollment_id#10798L, instruction_id#10799L, enrollment_start_time#10800, enrollment_end_time#10801, enrollment_class#10802, enrollment_status#10803, last_modified_date#10804, etl_date#10805] iceberg.warehouse.enrollment_fact iceberg.warehouse.enrollment_fact\n                                                :  :  :  +- SubqueryAlias inf\n                                                :  :  :     +- SubqueryAlias iceberg.warehouse.instruction_fact\n                                                :  :  :        +- RelationV2[instruction_id#10806L, program_semester_id#10807, course_id#10808L, class_id#10809L, is_required#10810, num_student#10811L, num_pass_student#10812L, num_fail_student#10813L, avg_final_score#10814, instruction_status#10815, instruction_allocate#10816, instruction_time_start#10817, instruction_time_end#10818, last_modified_date#10819, etl_date#10820] iceberg.warehouse.instruction_fact iceberg.warehouse.instruction_fact\n                                                :  :  +- SubqueryAlias ps\n                                                :  :     +- SubqueryAlias iceberg.warehouse.program_semester\n                                                :  :        +- RelationV2[program_semester_id#10821, program_id#10822, semester_name#10823, total_credit#10824L, required_credit#10825L, elective_credit#10826L] iceberg.warehouse.program_semester iceberg.warehouse.program_semester\n                                                :  +- SubqueryAlias c\n                                                :     +- SubqueryAlias iceberg.warehouse.course\n                                                :        +- RelationV2[course_id#10827L, course_name#10828, course_code#10829L, category#10830, total_credit#10831L, theory_credit#10832L, practice_credit#10833L, self_learning_credit#10834L] iceberg.warehouse.course iceberg.warehouse.course\n                                                +- SubqueryAlias sf\n                                                   +- SubqueryAlias iceberg.warehouse.score_fact\n                                                      +- RelationV2[score_id#10835L, instruction_id#10836L, student_id#10837, final_score#10838, final_score_4#10839, academic_rank#10840, is_practice#10841, last_modified_date#10842, etl_date#10843] iceberg.warehouse.score_fact iceberg.warehouse.score_fact\n"), operationHandle=None); 38140)
[2024-12-17T05:26:36.602+0000] {local_task_job_runner.py:240} INFO - Task exited with return code 1
[2024-12-17T05:26:36.668+0000] {taskinstance.py:3498} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-12-17T05:26:36.687+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
